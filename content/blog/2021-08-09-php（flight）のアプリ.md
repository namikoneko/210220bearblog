---
title: php（flight）のアプリを作ったときの備忘
slug: php-flight-application
date: 2021-08-09T04:10:33.370Z
description: php（flight）のアプリの備忘です
tags:
  - php
---
## ディレクトリ
/210808

## メモ

smarty使うと，定型的ならいいけれど，カスタマイズが大変とわかった

変数を`assign`でテンプレートに渡すのが面倒（よく忘れる）

htmlを制御するとき，フラグ変数を渡すと，数が多くなり，自分が作ったフラグの意味を理解するのが大変になる

テンプレートの数がすごいことになる，多くなる

`str .=`で，php内で文字列を作って，最後にechoで吐き出すようにした

原始的な方法に戻すことにした



定型的な関数や，headerやfooterのhtmlは，classを作ってこれらで書いて，再利用しやすいようにした

classのプロパティからは，別のプロパティの値を取得できないようなので（$this->hogeで取得できないようなので）これをしたいときは，あえてメソッドにした



updateのformへ飛ぶリンクなどは，table，updateを実行後に戻るurlなどを，引数で渡すことで抽象化して，その後のupdate実行まで共通化した

dbからクエリして$rowsを取得するところは，index.phpに直接書いて，基本的に共通化しないようにした
（共通化しようとしても，必ずバラエティが出てきて，「共通化コード」を作ってもかえってマイナスと思った）

悩んだのが，dbをカスタマイズしてフィールド（カラム）を増やしたときにどうするかである

### フォーム

以下の，insertとupdateのformを，カスタマイズできるようにした
ヒアドキュメントで，追加するフィールドのhtmlを直接書くようにした

- insform2
- updform2

### 実行

formのnameと，dbのカラム名を，必ず同じにして，insexe, updexeの関数に，フィールド名の配列を渡す

insexe, updexeの関数では，foreachでこの配列を回して，コードを作る

結局，以下の4箇所を変更することになる

|CRUD|フォーム|関数(exe)|
|:--|:--|:--|
|insert|①insform2|③insexe2|
|update|②updform2|④updexe|

関数(exe)の方は，`$insupdcol`などの配列名にして，コードの最初の方で書くなどして，共通化はできるとは思っている

フォームは，共通化は難しいと思っている

inputのtypeがdateだったり，表示の順番を考えたり，flexで横並びにしたり，$idで引数を受けてnameがparentidにしたり，パターン化は難しいと思う

### url

updformurlなど，urlの設定は，ルーティングのため（だけ）のもの

index.phpにルーティングを書いて，そのurlを受け取った後，さらにclassの関数を実行したりしている

あまりに自動化すると，ブラックボックス化して中身がわからなくなるので，あえてこうしている

このルーティングのときに，パラメーターを渡していることもある

### 既存のページを，少し変えたページを作りたいとき

現在は，flightのルーティングのOptional Parametersとifを使って，変更したい箇所を場合分けしている

共通部分を，そのアプリだけの「汎用的でない」classに切り分けて，これを呼び出すようにしてもいいかもしれない（共通サブルーチン）